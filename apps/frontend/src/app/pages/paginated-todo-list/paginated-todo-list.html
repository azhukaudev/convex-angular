<div class="mx-auto flex min-h-svh max-w-xl flex-col gap-8 px-4 py-8">
  <div class="flex flex-col gap-2">
    <div class="flex items-center justify-between">
      <h1 class="text-4xl font-extrabold opacity-80">Paginated Example</h1>
      <a href="/" class="text-primary hover:underline">← Home</a>
    </div>
    <p class="text-sm text-gray-500">
      Using injectPaginatedQuery with load more
    </p>
    <a href="/examples/basic" class="text-primary text-sm hover:underline">
      See Basic Example →
    </a>
  </div>

  <div class="flex items-center gap-4">
    <div class="flex items-center gap-2">
      <label for="pageSize" class="text-sm font-medium">Page Size:</label>
      <p-inputNumber
        inputId="pageSize"
        [(ngModel)]="pageSize"
        [min]="1"
        [max]="50"
        [showButtons]="true"
        buttonLayout="horizontal"
        inputStyleClass="w-16 text-center"
        decrementButtonClass="p-button-secondary"
        incrementButtonClass="p-button-secondary"
        incrementButtonIcon="pi pi-plus"
        decrementButtonIcon="pi pi-minus"
      />
    </div>
    <p-button
      icon="pi pi-refresh"
      label="Reset"
      severity="secondary"
      size="small"
      (onClick)="handleReset()"
    />
  </div>

  <div class="flex items-center gap-2">
    <p-button
      icon="pi pi-check"
      label="Complete All"
      severity="secondary"
      (onClick)="handleCompleteAll()"
    />
    <p-button
      icon="pi pi-undo"
      label="Reopen All"
      severity="secondary"
      (onClick)="handleReopenAll()"
    />
  </div>

  <form (ngSubmit)="handleAddTodo()" class="flex items-center gap-2">
    <div class="flex-grow">
      <input
        #newTaskInput
        name="new-task"
        type="text"
        pInputText
        [(ngModel)]="newTask"
        placeholder="Add new task"
        autocomplete="off"
        class="w-full shadow-xs"
      />
    </div>
    <div>
      <p-button
        type="submit"
        icon="pi pi-plus"
        label="New Task"
        [disabled]="!newTaskInput.value"
      />
    </div>
  </form>

  @if (todos.isLoadingFirstPage()) {
    <div class="flex justify-center py-8">
      <p-progress-spinner
        aria-label="Loading first page"
        class="size-10"
        strokeWidth="8"
      />
    </div>
  } @else {
    <ul class="flex flex-col gap-4">
      @for (task of todos.results(); track task._id) {
        <li
          class="border-surface-200 flex items-center justify-between gap-2 rounded-md border px-2 py-1 shadow-xs"
        >
          <div class="flex items-center gap-2">
            <p-checkbox
              [ngModel]="task.completed"
              [binary]="true"
              (ngModelChange)="handleTodoChange(task._id, task.completed)"
            />
            <span>{{ task.title }}</span>
          </div>
          <p-button
            icon="pi pi-trash"
            aria-label="Delete"
            severity="danger"
            variant="text"
            (onClick)="handleDeleteTodo(task._id)"
          />
        </li>
      } @empty {
        <li class="py-4 text-center text-gray-500">
          No tasks yet. Add one above!
        </li>
      }
    </ul>

    <!-- Load More Section -->
    <div class="flex flex-col items-center gap-2 py-4">
      @if (todos.isLoadingMore()) {
        <div class="flex items-center gap-2">
          <p-progress-spinner
            aria-label="Loading more"
            class="size-6"
            strokeWidth="6"
          />
          <span class="text-sm text-gray-500">Loading more...</span>
        </div>
      } @else if (todos.canLoadMore()) {
        <p-button
          icon="pi pi-arrow-down"
          [label]="'Load More (' + pageSize() + ')'"
          severity="secondary"
          (onClick)="handleLoadMore()"
        />
        <span class="text-xs text-gray-400">
          {{ todos.results().length }} items loaded
        </span>
      } @else if (todos.isExhausted()) {
        <div class="flex flex-col items-center gap-1">
          <span class="text-sm font-medium text-green-600">
            ✓ All items loaded
          </span>
          <span class="text-xs text-gray-400">
            {{ todos.results().length }} total items
          </span>
        </div>
      }

      @if (todos.error()) {
        <div class="text-sm text-red-500">
          Error: {{ todos.error()?.message }}
          <button class="ml-2 underline" (click)="handleLoadMore()">
            Retry
          </button>
        </div>
      }
    </div>
  }
</div>
